# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные, используемые в приложении
#### Интерфейс, описывающий товар
```
interface IProduct = {
    id: string;
    title: string;
    description: string;
    price: number || null;
    image: string;
    category: string;
}
```

#### Интерфейс, описывающий заказ
```
interface IOrder = {
    payment: string;
    address: string;
    email: string;
    phone: string;
    total: number;
    items: string[];
}
```

#### Интерфейс, описывающий успешный заказ
```
interface IOrderResult = {
    id: string;
    total: number;
}
```

#### Данные для оформления заказа(оплата)
`type TOrderPaymentInfo = Pick<IOrder, 'payment' | 'address'>`;

#### Данные для оформления заказа (контакты) 
`type TOrderContactsInfo = Pick<Iorder, 'email' | 'phone'>`;

#### ID карточки для просмотра подробной информации о карточке
`type TProductId = Pick<IProduct, 'id'>;`

#### Данные для добавления карточки в корзину
`type TBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;`

## Используемые паттерн

В проекте используется паттерн MVP(Model-View-Presenter). 
Model - отвечает за основную логику приложения, руководит бизнес-процессами. В модель входят основные данные программы, методы работы с ними.
View - отвечает за визуальное отображение. Представление показывает пользователю интерфейс и данные из модели на экране. 
Presenter - служит прослойкой между моделью и представлением.

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

## Слой данных

### ProductData
Класс необходим для хранения данных о товарах и работы с этими данными. В параметрах конструктора задается экземпляр брокера событий.
#### Поля класса: 
- `productList: IProduct[]` - массив карточек товаров.
- `events: IEvents` - экземпляр класса EventEmitter, который инициирует событие при изменении данных.
#### Методы класса: 
- `getProductsList(): IProduct[]` - получение объекта с товарами.
- `setProductsList(productsData: IProduct): IProductsList` - устанавливает значение объекта с товарами.
- `getProductById(id: string): IProduct` - получение объекта товара по id.

### OrderData
Класс необходим для работу и хранения данных о заказах. В параметрах конструктора задается экземпляр брокера событий.
#### Поля класса:
- `_order: IOrder` - данные для заказа.
- `basket: TBasketItem[]` - товары в корзине.
- `formErrors` - ошибки при валидации.
- `events: IEvents` - экземпляр класса EventEmitter, который инициирует событие при изменении данных.
#### Методы класса:
- `addProduct(product: TBasketItem)` - добавляет товар в корзину и заказ.
- `deleteProduct(idProduct: string)` - удаляет товар из корзины и заказа.
- `getTotal()` - получение общей стоимости заказа.
- `updateTotal()` - обновление общей стоимости заказа.
- `clearDataForms()` - очистка формы для заказа.
- `clearBasket()` - очистка корзины.
- `setOrderField(field: keyof TFormOrder, value: string)` - получение полей формы для заказа.
- `validateOrder()` - проверка на валидность полей формы заказа.
- `setContactsField(field: keyof TFormContacts, value: string)` - получение полей формы контактов.
- `validateContacts()` - проверка на валидность полей формы контактов.

## Слой представления
Все классы представления отвечают за отображение внутри контейнеров (DOM-элемент) передаваемых в них данных.

### Класс Component
Класс Component предоставляет базовый функционал для создания UI компонентов, работающих с DOM элементами. Это абстрактный класс, который предназначен для наследования и предоставляет общие методы для управления отображением.
#### Методы класса: 
- `toggleClass` - метод для переключения класса (удалить/добавить).
- `setText` - метод для установки текстового сообщения.
- `setDisabled` - метод для смены статуса блокировки (disabled).
- `setHidden` - метод для сокрытия элемента (display: none).
- `setVisible` - метод, чтобы показать элемент (убирает свойство display).
- `setImage` - метод для установки изображения. Устанавливает значения для src и alt.
- `render` - метод для отрисовки DOM-элементов.

### Класс Page
Реализует создание главной страницы, расширяет класс Component. Используется для отображения каталога товаров в виде превью, иконки корзины с количеством товаров в ней. 
#### Конструктор класса
- `constructor(container: HTMLElement, events: IEvents)` - в конструктор передается разметка, которая находится на главной странице, а также экземпляр класса EventEmitter, который инициирует событие при изменении данных. 
#### Поля класса 
- `basketCounter: HTMLElement` - счетчик количества элементов в корзине.
- `basketButton: HTMLButtonElement` - кнопка, открывающая модальное окно корзины.
- `cardCatalog: HTMLElement` - каталог с превью товаров.
#### Методы класса
- `setLocked(val: boolean)` - при открытом модальном окне страница блокируется.
- `updateBasktCounter(count: number)` - обновляет количество товаров в корзине на главной странице

### Класс Modal
Реализует модальные окна программы. Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик по кнопке закрытия модального окна и на клик по оверлею - они закрывают попап.
#### Поля класса
- `modal: HTMLElement` - элемент модального окна.
- `events: IEvents` - брокер событий.

### Класс Form
Реализует формы, расширяет класс Component. При нажатии кнопки подтверждения отправки формы инициирует событие, передавая в него объект с данными формы. При изменении данных в полях ввода инициируется событие изменения данных в полях. Содержит методы для отображения ошибок в форме, а также для управления состоянием кнопки.
#### Поля класса 
- `submit: HTMLButtonElement` - кнопка для подтверждения отправки формы.
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
#### Методы класса 
- `onInputChange(field: keyof T, value: string)` - инициализирует передачу данных из поля при их изменении.
- `reset` - используется для сброса введенных данных.

### Класс EventDataOrderSubmit
Класс, реализующий форму с данными об оплате. Расширяет класс Form.
#### Поля класса
- `paymentMethod: NodeListOf<HTMLButtonElement>` - кнопка для выбора способа оплаты.
- `address: string` - хпеременная для хранения адреса доставки.

### Класс EventDataContactsSubmit
Класс, реализующий форму с контактными данными. Расширяет класс Form.
#### Поля класса
- `email: string` - переменная для хранения электронного адреса.
- `phone: string` - переменная для хранения номера телефона.

### Класс SuccessOrder
Класс, реализующий окно сообщения об успешном заказе.
#### Поля класса 
- `id: string` - переменная для хранения id товара
- `total: number` - переменная для хранения общей суммы за заказ

### Класс ProductPreview
Класс, реализующий отображение карточек на главной странице. Расширяет класс Component.
#### Конструктор класса
- `constructor(container: HTMLElement, events: IEvents)` - в конструктор передается разметка, которая находится в карточке товара, а также экземпляр класса EventEmitter, который инициирует событие. 
#### Поля класса
- `id: string` - переменная для хранения id товара.
- `category: HTMLElement` - элемент категории товара.
- `title: HTMLElement` - элемент названия товара.
- `image: HTMLElement` - элемент картинка товара.
- `price: HTMLElement` - элемент цены товара.
#### Методы класса 
- `getCategoryClass: (category: string) => string` - метод для получения категории товара

### Класс Product
Класс, реализующий карточку товара с полной информацией. Расширяет класс ProductPreview. Также реализует добавление удаление товара из корзины через кнопку добавления/удаления. 
#### Конструктор класса
- `constructor(container: HTMLElement, events: IEvents)` - в конструктор передается разметка, которая находится в модальном окне карточки товара, а также экземпляр класса EventEmitter, который инициирует событие при изменении данных. 
#### Поля класса
- `description: HTMLElement` - элемент описания товара.
- `cardButton: HTMLButtonElement`- кнопка добавления/удаления товара из корзины.
- `currentProduct: IProduct` - указывает на текущий товар, модальное окно которого открыто.
#### Методы класса
- `setCardButtonText(isProductInBasket: boolean)` - изменение текста на карточке в зависимости от того находится ли товар в корзине.
- `updateButtonState(inBasket: boolean, hasPrice: boolean): void` - кнопка добавления в корзину становится disabled если цена товара "бесценно" или если товар уже в корзине и менянет надпись на кнопке

### Класс Basket
Класс для отображения корзины с товарами. Расширяет класс Component. Отображает контейнер со списком товаров, а также общую сумму и кнопку "Оформить".
#### Конструктор класса
- `constructor(container: HTMLElement, events: IEvents)` - в конструктор передается разметка, которая находится в модальном окне, а также экземпляр класса EventEmitter, который инициирует событие при изменении данных. 
#### Поля класса 
- `basketList: HTMLElement` - список товаров, которые находятся в корзине.
- `total: HTMLElement` - сумма за все товары.
- `orderButton: HTMLButtonElement` - кнопка для оформления заказа. 
#### Методы класса 
- `renderBasket(items: TBasketItem[])` - отображение товаров в корзине
- `updateTotal: (total: number) => void` - обновление суммы на оплату всей корзины.

### Класс BasketItem
Класс для отображения товаров в корзине. Расширяет класс Component.
#### Поля класса: 
- `productId: string` - переменная для получения id товара
- `count: number` - переменная для получения порядкового номера
- `title: HTMLElement` - переменная для отображения названия товара
- `price: HTMLElement` - переменная для отображения цены товара
- `deleteButton: HTMLButtonElement` - переменная для отображения кнопки удаления
#### Методы класса 
- `setCount: (count: number) => void` - метод для получения порядкового номера товара в корзине


## Слой презентера
Код прекзентера не будет выделен в отдельный класс, он будет реализован в основном скрипте приложения (index.ts). В данном файле сначала будут создаваться экземпляры всех необхоодимых классов, а затем будет настроена обрабротка событий.